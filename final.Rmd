---
title: "Final"
author: "Felix Bridgeman & Liam Varela"
date: "2024-05-02"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(MASS)
library(biotools)
library(klaR)
library(car)
library(lubridate)
library(readxl)
library(ggExtra)
library(GGally)
library(plotly)
library(heplots)
library(nnet)
library(pROC)
library(corrplot)
library(aplpack)
library(fpc)
library(cluster)
library(ape)
library(vegan)
library(vegan3d)
library(mgcv)
library(rgl)
library(psych)
library(EFAtools)
library(knitr)
library(kableExtra)
library(dplyr)
library(pubtheme)
```

# Import Data

```{r}
dred <- read.csv("data/winequality-red.csv", sep = ";") %>%
  mutate(type = 1)
dwhite <- read.csv("data/winequality-white.csv" , sep = ";") %>%
  mutate(type = 0)

# in case we want to analyze a subset because too many datapoints can hinder interpretability
# we can also perfomr PCA on white and red wine separately
dred_subset <- dred[sample(nrow(dred), 100), ]
dwhite_subset <- dwhite[sample(nrow(dwhite), 100), ]

wines <- rbind(dred, dwhite)

head(wines)

# make ID column
wines$ID <- 1:nrow(wines)
# move ID column to front
wines <- wines[,c(ncol(wines), 1:(ncol(wines)-1))]

```

# Background and Motivation



# Research Question

- Which variables influence quality the most?
- Can we identify particular categories of wine based on combinations of variables?

# Data Description

We have 13 variables in our dataset.

| Variable | Type | Description |
|----------|------|-------------|
| ID | integer | unique identifier for each wine |
| type | categorical | red or white wine |
| quality | integer, categorical | rating of the wine from 0 to 10 with 10 being the best |
| fixed acidity | continuous | most acids involved with wine or fixed or nonvolatile |
| volatile acidity | continuous | the amount of acetic acid in wine, which at too high of levels can lead to an unpleasant, vinegar taste |
| citric acid | continuous | found in small quantities, citric acid can add 'freshness' and flavor to wines |
| residual sugar | continuous | the amount of sugar remaining after fermentation stops, it's rare to find wines with less than 1 gram/liter and wines with greater than 45 grams/liter are considered sweet |
| chlorides | continuous | the amount of salt in the wine |
| free sulfur dioxide | continuous | the free form of SO2 exists in equilibrium between molecular SO2 (as a dissolved gas) and bisulfite ion; it prevents microbial growth and the oxidation of wine |
| total sulfur dioxide | continuous | amount of free and bound forms of S02; in low concentrations, SO2 is mostly undetectable in wine, but at free SO2 concentrations over 50 ppm, SO2 becomes evident in the nose and taste of wine |
| density | continuous | the density of water is close to that of water depending on the percent alcohol and sugar content |
| pH | continuous | describes how acidic or basic a wine is on a scale from 0 (very acidic) to 14 (very basic); most wines are between 3-4 on the pH scale |
| sulphates | continuous | a wine additive which can contribute to sulfur dioxide gas (S02) levels, wich acts as an antimicrobial and antioxidant |
| alcohol | continuous | the percent alcohol content of the wine |

# Summaries of Data

```{r}
summary(wines)
```

# Plots

```{r, fig.width=8, fig.height=10}
# plot histograms of all variables
dd <- wines %>%
  pivot_longer(cols = -ID,
               names_to = "variable",
               values_to = "value")
g <- ggplot(dd,
            aes(x = value)) +
  geom_histogram(bins = 30) +
  facet_wrap(~variable, scales = "free",
             nrow = 5)

g

```

## Comments:

- pH appears normally distributed
- sulphates, alcohol, and quality appear right-skewed

## Now let's standardize data

```{r, fig.width=8, fig.height=10}
dc <- wines
dc[-1] <- scale(wines[-1])

dd <- dc %>%
  pivot_longer(cols = -ID,
               names_to = "variable",
               values_to = "value")

g <- ggplot(dd,
            aes(x = value)) +
  geom_histogram(bins = 30) +
  facet_wrap(~variable, scales = "free",
             nrow = 5)
g
```

\newpage

# PCA

### Check some assumptions

```{r, fig.height=10, fig.width=10, warning=FALSE}
# pairs(wines)
chart.Correlation(wines[, -13])

wines_trans <- wines %>% 
  mutate(log_total.sulfur.dioxide = log(total.sulfur.dioxide),
         log_free.sulfur.dioxide = log(free.sulfur.dioxide)) %>% 
  select(-free.sulfur.dioxide, -total.sulfur.dioxide)
wines_trans <- wines_trans[,c(1,2,3,4,5,6,7,8,9,12,13,10,11)]

chart.Correlation(wines_trans[,-13])
cqplot(wines_trans)

# ## gets rid of some of the mahalanobis outliers to make cq plot look nicer
# wines_trans <- wines_trans[-which.max(mahalanobis(wines_trans, colMeans(wines_trans), cov(wines_trans))),]
# cqplot(wines_trans)

wines_trans[,1:11] <- scale(wines_trans[,1:11])

corrplot.mixed(cor(wines[,-1]), lower.col = "black", upper = "ellipse", tl.col = "black", number.cex = .7, order = "hclust", tl.pos = "lt", tl.cex = .7)
```

### run PCA

```{r, fig.height=20, fig.width=20}
wine_pc1 <- princomp(wines_trans, cor = TRUE)

summary(wine_pc1)

#Get loadings
print(wine_pc1$loadings, cutoff = 0, digits = 2)

#Get eigenvalues
round(wine_pc1$sdev^2, 2)

#make a screeplot  
screeplot(wine_pc1, type = "lines", col = "red", lwd = 2, pch = 19, cex = 1.2, 
          main = "Scree Plot of Transformed WB Data")

source("http://www.reuningscherer.net/multivariate/R/parallel.r.txt")

#make the parallel analysis plot
#parallelplot(wine_pc1)

source("http://reuningscherer.net/multivariate/r/ciscoreplot.R.txt")

#run the function
ciscoreplot(wine_pc1, c(1, 2), wines_trans[,13])

biplot(wine_pc1, choices = c(1,2), pc.biplot = T)
biplot(wine_pc1, choices = c(1,3), pc.biplot = T)
biplot(wine_pc1, choices = c(2,3), pc.biplot = T)
```

# Discriminant Analysis

```{r}

# for DA lets make another categorical variable so that our results will be more interesting
breaks <- c(0,1,10,35,120,220)
wines$sugar.factor <- cut(wines$residual.sugar, breaks = breaks, labels = c("bone-dry", "dry", "off-dry", "sweet", "very-sweet"), include.lowest = TRUE)

for (i in 1:12) {  # Assuming first column is 'Group'
  boxplot(wines[, i] ~ wines$type, main = names(wines)[i], xlab = "White (0) vs Red (1)", ylab = "Vals", col = rainbow(3))
}


```








